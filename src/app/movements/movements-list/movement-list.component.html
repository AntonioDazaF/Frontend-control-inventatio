<div class="movements-header">
  <h2>Movimientos</h2>
  <button mat-raised-button color="primary" (click)="nuevoMovimiento()">
    <mat-icon>add</mat-icon> Nuevo Movimiento
  </button>
</div>

<!-- Campo de búsqueda -->
<mat-form-field appearance="outline" class="search-field">
  <mat-label>Buscar movimiento</mat-label>
  <input
    matInput
    [(ngModel)]="searchTerm"
    placeholder="Buscar por producto"
    (keyup)="filtrar()"
  />
  <mat-icon matSuffix>search</mat-icon>
</mat-form-field>

<!-- Tabla de movimientos -->
<table mat-table [dataSource]="movimientos" class="mat-elevation-z8 full-width-table">

  <!-- ID -->
  <ng-container matColumnDef="id">
    <th mat-header-cell *matHeaderCellDef>ID</th>
    <td mat-cell *matCellDef="let m">{{ m.id }}</td>
  </ng-container>

  <!-- Producto -->
  <ng-container matColumnDef="producto">
    <th mat-header-cell *matHeaderCellDef>Producto</th>
    <td mat-cell *matCellDef="let m">{{ m.producto?.nombre || '—' }}</td>
  </ng-container>

  <!-- Tipo -->
  <ng-container matColumnDef="tipo">
    <th mat-header-cell *matHeaderCellDef>Tipo</th>
    <td mat-cell *matCellDef="let m">
      <span
        class="tipo-badge"
        [ngClass]="{
          'tipo-entrada': m.tipo === 'ENTRADA',
          'tipo-salida': m.tipo === 'SALIDA'
        }"
      >
        {{ m.tipo }}
      </span>
    </td>
  </ng-container>

  <!-- Cantidad -->
  <ng-container matColumnDef="cantidad">
    <th mat-header-cell *matHeaderCellDef>Cantidad</th>
    <td mat-cell *matCellDef="let m">{{ m.cantidad }}</td>
  </ng-container>

  <!-- Fecha -->
  <ng-container matColumnDef="fecha">
    <th mat-header-cell *matHeaderCellDef>Fecha</th>
    <td mat-cell *matCellDef="let m">
      {{ m.fecha | date: 'short' : 'es-CO' }}
    </td>
  </ng-container>

  <!-- Usuario -->
  <ng-container matColumnDef="usuario">
    <th mat-header-cell *matHeaderCellDef>Usuario</th>
    <td mat-cell *matCellDef="let m">
      {{ m.usuario || usuarioActual || 'Sistema' }}
    </td>
  </ng-container>

  <!-- Filas -->
  <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
  <tr mat-row *matRowDef="let row; columns: displayedColumns"></tr>
</table>

<!-- Mensaje cuando no hay datos -->
<div *ngIf="movimientos.length === 0" class="loading">
  No hay movimientos registrados.
</div>
